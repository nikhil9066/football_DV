<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Interactive World Map with Match Data and Country Locations</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 40px;
      /* Double the margin */
      overflow: hidden;
    }

    #map {
      border: 1px solid black;
      /* Add a thin black border */
      background-color: rgb(91, 134, 198);
    }

    path {
      fill: #ccc;
      stroke: #fff;
      stroke-width: 0.5;
    }

    path:hover {
      fill: #4adc2d;
    }

    .country-label {
      font-size: 12px;
      fill: #333;
      pointer-events: none;
    }

    .match-info {
      font-size: 14px;
      fill: #333;
      pointer-events: none;
    }

    .city {
      fill: black;
    }

    .city:hover {
      stroke: red;
    }

    .city-info {
      font-size: 12px;
      fill: #333;
      pointer-events: none;
      display: none;
    }

    .info-box {
      position: absolute;
      margin-bottom: 2px;
      left: 10px;
      top: 10px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 5px;
      border: 1px;
    }

    body {
      background-color: black;
    }
  </style>
</head>

<body id="back">
  <svg id="map"></svg>
  <div class="info-box"></div>

  <script>
    // Data paths
    var geoJSONPath = "world-countries.geojson";
    var matchDataPath = "updated_data.json";

    var svg = d3.select("#map");
    var margin = 40; // Doubled the margin
    var width = window.innerWidth - 2 * margin;
    var height = window.innerHeight - 2 * margin;

    svg.attr("width", width).attr("height", height);

    var projection = d3.geoMercator()
      .scale(width / 2 / Math.PI)
      .translate([width / 2, height / 2]);

    var path = d3.geoPath().projection(projection);

    var mapGroup = svg.append("g").attr("transform", "translate(" + margin + "," + margin + ")");

    // Load and display the map
    d3.json(geoJSONPath).then(function (world) {
      // Create map paths
      var countries = mapGroup.selectAll(".country")
        .data(world.features)
        .enter().append("path")
        .attr("d", path)
        .attr("class", "country")
        .on("mouseover", function (d) {
          d3.select(this).attr("fill", "#99ccff");
        })
        .on("mouseout", function (d) {
          d3.select(this).attr("fill", "#ccc");
          mapGroup.selectAll(".match-info").remove();
        });

      // Add country labels with trimmed names
      mapGroup.selectAll("text")
        .data(world.features)
        .enter().append("text")
        .attr("class", "country-label")
        .attr("transform", function (d) {
          var centroid = path.centroid(d);
          return "translate(" + centroid + ")";
        })
        .attr("dy", "0.35em")
        .text(function (d) {
          return d.properties.name.substr(0, 2); // Trimmed to two letters
        });
    });

    // Load and display match data
    d3.json(matchDataPath).then(function (matches) {
      mapGroup.selectAll(".city")
        .data(matches)
        .enter()
        .append("circle")
        .attr("class", "city")
        .attr("r", 4)
        .attr("cx", function (d) {
          return projection([d.city_longitude, d.city_latitude])[0];
        })
        .attr("cy", function (d) {
          return projection([d.city_longitude, d.city_latitude])[1];
        })
        .on("mouseover", function (event, d) {
          if (event.target.tagName === "circle") {
            d3.select(this).attr("stroke", "red");
            var matchInfo =
              `Date: ${d.date}, Home Team: ${d.home_team}, Away Team: ${d.away_team}, Result: ${d.home_score}-${d.away_score}`;
            var infoBox = d3.select(".info-box");
            infoBox.html(matchInfo);
          }
        })
        .on("mouseout", function () {
          d3.select(this).attr("stroke", "none");
          d3.select(".info-box").html("");
        });
    });

    // Enable zoom
    svg.call(d3.zoom().on("zoom", function () {
      mapGroup.attr("transform", d3.event.transform);
    }));
  </script>
</body>

</html>