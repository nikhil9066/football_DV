<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Score Distribution</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Add your styling here if needed */
    .barHome {
      fill: steelblue;
    }

    .barAway {
      fill: orange;
    }
  </style>
</head>

<body>

  <!-- Buttons for Continents -->
  <div id="buttons">
    <!-- D3.js will create buttons here -->
  </div>

  <!-- Container for D3.js Graphs -->
  <div id="graphs">
    <!-- D3.js will render graphs here -->
  </div>

  <script>
    // Initial continent
    var currentContinent;
    var borderGap = 20; // Adjusted for better separation
    var graphGap = 50; // Added gap between the graphs

    // Function to dynamically load data from the map.json file
    async function fetchData() {
      try {
        const response = await fetch('map.json');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching data:', error);
        return null;
      }
    }

    // Function to update the graphs based on the selected continent
    async function updateGraph(continent) {
      // Update the current continent
      currentContinent = continent;

      // D3.js code for plotting the score distribution
      const data = await fetchData();
      if (!data) {
        console.error('Invalid or missing data overall');
        return;
      }

      if (!data[currentContinent]) {
        console.error('Invalid or missing data for the selected continent:', currentContinent);
        return;
      }

      var svg = d3.select("#graphs").html("").append("svg")
        .attr("width", 800)
        .attr("height", 500); // Increased height for more space

      var margin = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      };
      var width = 800 - margin.left - margin.right;
      var height = 500 - margin.top - margin.bottom; // Updated height

      // Create a single group for both home scores and away scores
      var scoreGroup = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Fetch home and away scores data for the selected continent
      var homeScores = data[currentContinent].map(function (d) {
        return d.home_score;
      });
      
      var awayScores = data[currentContinent].map(function (d) {
        return d.away_score;
      });

      // Create histogram scales for home scores
      var xHome = d3.scaleLinear()
        .domain([d3.min(homeScores), d3.max(homeScores)])
        .range([0, width / 2]);

      var yHome = d3.scaleLinear()
        .range([height, 0]);

      // Create histogram scales for away scores
      var xAway = d3.scaleLinear()
        .domain([d3.min(awayScores), d3.max(awayScores)])
        .range([0, width / 2]);

      var yAway = d3.scaleLinear()
        .range([height, 0]);

      // Generate histograms for home scores
      var histogramHome = d3.histogram()
        .domain(xHome.domain())
        .thresholds(xHome.ticks(20));

      var binsHome = histogramHome(homeScores);

      yHome.domain([0, d3.max(binsHome, function (d) {
        return d.length;
      })]);

      // Create bars for home scores
      scoreGroup.selectAll(".barHome")
        .data(binsHome)
        .enter().append("rect")
        .attr("class", "barHome")
        .attr("x", function (d) {
          return xHome(d.x0);
        })
        .attr("y", function (d) {
          return yHome(d.length);
        })
        .attr("width", function (d) {
          return Math.max(0, xHome(d.x1) - xHome(d.x0) - 1);
        })
        .attr("height", function (d) {
          return height - yHome(d.length);
        });

      // Generate histograms for away scores
      var histogramAway = d3.histogram()
        .domain(xAway.domain())
        .thresholds(xAway.ticks(20));

      var binsAway = histogramAway(awayScores);

      yAway.domain([0, d3.max(binsAway, function (d) {
        return d.length;
      })]);

      // Create bars for away scores
      scoreGroup.selectAll(".barAway")
        .data(binsAway)
        .enter().append("rect")
        .attr("class", "barAway")
        .attr("x", function (d) {
          return width / 2 + xAway(d.x0);
        })
        .attr("y", function (d) {
          return yAway(d.length);
        })
        .attr("width", function (d) {
          return Math.max(0, xAway(d.x1) - xAway(d.x0) - 1);
        })
        .attr("height", function (d) {
          return height - yAway(d.length);
        });

      // Add axis labels and titles for home scores
      scoreGroup.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xHome));

      scoreGroup.append("g")
        .call(d3.axisLeft(yHome).ticks(10));

      scoreGroup.append("text")
        .attr("transform", "translate(" + (width / 4) + "," + (height + margin.top + 20) + ")")
        .style("text-anchor", "middle")
        .text("Home Score");

      // Add axis labels and titles for away scores
      scoreGroup.append("g")
        .attr("transform", "translate(" + (width / 2) + "," + height + ")")
        .call(d3.axisBottom(xAway));

      scoreGroup.append("g")
        .call(d3.axisLeft(yAway).ticks(10));

      scoreGroup.append("text")
        .attr("transform", "translate(" + (3 * width / 4) + "," + (height + margin.top + 20) + ")")
        .style("text-anchor", "middle")
        .text("Away Score");

      // Add a border and heading for Distribution of Home Scores
      scoreGroup.append("rect")
        .attr("x", -borderGap)
        .attr("y", -borderGap)
        .attr("width", width / 2 + 2 * borderGap)
        .attr("height", height + 2 * borderGap)
        .style("stroke", "black")
        .style("fill", "none");

      // Add a border and heading for Distribution of Away Scores
      scoreGroup.append("rect")
        .attr("x", width / 2 - borderGap)
        .attr("y", -borderGap)
        .attr("width", width / 2 + 2 * borderGap)
        .attr("height", height + 2 * borderGap)
        .style("stroke", "black")
        .style("fill", "none");

      // Add heading for Distribution of Home Scores
      scoreGroup.append("text")
        .attr("x", width / 4)
        .attr("y", -borderGap / 2)
        .style("text-anchor", "middle")
        .style("font-weight", "bold")
        .text("Distribution of Home Scores");

      // Add heading for Distribution of Away Scores
      scoreGroup.append("text")
        .attr("x", 3 * width / 4)
        .attr("y", -borderGap / 2)
        .style("text-anchor", "middle")
        .style("font-weight", "bold")
        .text("Distribution of Away Scores");

      // Add x-axis label for home scores
      scoreGroup.append("text")
        .attr("transform", "translate(" + (width / 4) + "," + (height + margin.top + 50) + ")")
        .style("text-anchor", "middle")
        .text("Home Score");

      // Add y-axis label for home scores
      scoreGroup.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", -margin.left)
        .attr("x", -(height / 4))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Frequency");

      // Add x-axis label for away scores
      scoreGroup.append("text")
        .attr("transform", "translate(" + (3 * width / 4) + "," + (height + margin.top + 50) + ")")
        .style("text-anchor", "middle")
        .text("Away Score");

      // Add y-axis label for away scores
      scoreGroup.append("text")
        .attr("transform", "translate(" + (width) + "," + height / 4 + ") rotate(90)")
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Frequency");
    }

    // Create buttons for each continent
    var continents = ["Africa", "Antarctica", "Asia", "Europe", "North America", "Oceania", "South America"];

    var buttons = d3.select('#buttons')
      .selectAll('button')
      .data(continents)
      .enter()
      .append('button')
      .text(function (d) {
        return d;
      })
      .on('click', function (event) {
        updateGraph(event.target.textContent);
      });

    // Initial graph render (default to the first continent)
    updateGraph(continents[0]);
  </script>

</body>

</html>
