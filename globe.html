<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Interactive World Map with Match Data and Country Locations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 40px;
            overflow: hidden;
            background-color: black;
            color: white;
        }

        #map {
            border: 1px solid black;
            background-color: #009dc4;
        }

        path {
            fill: #ccc;
            stroke: #fff;
            stroke-width: 0.5;
        }

        path:hover {
            fill: #4adc2d;
        }

        .country-label {
            font-size: 12px;
            fill: #333;
            pointer-events: none;
        }

        .match-info {
            font-size: 14px;
            fill: #333;
            pointer-events: none;
        }

        .city {
            fill: black;
            stroke: none;
        }

        .city:hover {
            stroke: red;
        }

        .city-info {
            font-size: 12px;
            fill: #333;
            pointer-events: none;
            display: none;
        }

        .info-box {
            position: absolute;
            left: 20px;
            top: 20px;
            border: 1px solid white;
            padding: 10px;
            color: white;
        }

        .next-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: white;
            color: black;
            text-decoration: none;
            font-weight: bold;
            border: 2px solid black;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .next-button:hover {
            background-color: #eee;
            transform: scale(1.1);
        }

        .info-box {
            position: absolute;
            left: 20px;
            top: 20px;
            background: rgba(0, 0, 0, 0.7);
            /* Semi-transparent black background */
            color: white;
            padding: 10px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
            /* Apply a blur effect to the background */
            transition: opacity 0.3s;
            /* Add a smooth transition for opacity changes */
            opacity: 0;
            /* Initially set to transparent */
        }

        .info-box:hover {
            opacity: 1;
            /* Show the info box when hovering over it */
        }
    </style>
</head>

<body>
    <svg id="map"></svg>
    <div class="info-box"></div>
    <div class="year-dropdown" style="position: absolute; top: 20px; right: 20px;">
        <label for="year-select">Select Year:</label>
        <select id="year-select"></select>
    </div>

    <script>
        console.log("hi");
        // Data paths
        var geoJSONPath = "geo/custom.geo.json";
        var matchDataPath = "geo/combined_data_final.json";

        // Set up the SVG container for the map
        var svg = d3.select("#map");
        var margin = 40;
        var width = window.innerWidth - 2 * margin;
        var height = window.innerHeight - 2 * margin;

        svg.attr("width", width).attr("height", height);

        // Define a projection for the map (Mercator projection)
        var projection = d3.geoMercator()
            .scale(width / 2 / Math.PI)
            .translate([width / 2, height / 2]);

        // Create a path generator using the projection
        var path = d3.geoPath().projection(projection);

        var mapGroup = svg.append("g").attr("transform", "translate(" + margin + "," + margin + ")");

        // Load and display the map
        d3.json(geoJSONPath).then(function (world) {
            // Create map paths
            var countries = mapGroup.selectAll(".country")
                .data(world.features)
                .enter().append("path")
                .attr("d", path)
                .attr("class", "country")
                .on("mouseover", function (event, d) {
                    if (event.target.tagName === "circle") {
                        d3.select(this).attr("stroke", "red");
                        var matchInfo =
                            `Date: ${d.date}, Home Team: ${d.home_team}, Away Team: ${d.away_team}, Result: ${d.home_score}-${d.away_score}`;
                        var infoBox = d3.select(".info-box");
                        infoBox.html(cityInfo);
                        console.log(cityInfo); // Log city information to the console
                        console.log(d); // Log the entire data object for debugging
                    }
                })
                .on("mouseout", function (d) {
                    d3.select(this).attr("stroke", "none");
                    var infoBox = d3.select(".info-box");
                    infoBox.html(""); // Clear info box
                });



            // Add country labels with trimmed names
            mapGroup.selectAll("text")
                .data(world.features)
                .enter().append("text")
                .attr("class", "country-label")
                .attr("transform", function (d) {
                    var centroid = path.centroid(d);
                    return "translate(" + centroid + ")";
                })
                .attr("dy", "0.35em")
                .text(function (d) {
                    return d.properties.name.substr(0, 2); // Trimmed to two letters
                });
        });

        // Load and display match data
        d3.json(matchDataPath).then(function (matches) {
            // Extract unique years
            var years = [...new Set(matches.map(match => match.date.substr(0, 4)))];

            // Populate the year dropdown options
            var yearDropdown = d3.select("#year-select");
            yearDropdown
                .selectAll("option")
                .data(years)
                .enter()
                .append("option")
                .text(year => year)
                .attr("value", year => year);

            function updateData(selectedYear) {
                var filteredMatches = matches.filter(match => match.date.startsWith(selectedYear));

                mapGroup.selectAll(".city").remove(); // Remove existing circles

                mapGroup.selectAll(".city")
                    .data(filteredMatches)
                    .enter()
                    .append("circle")
                    .attr("class", "city")
                    .attr("r", 4)
                    .attr("cx", function (d) {
                        var coordinates = projection([d.city_longitude, d.city_latitude]);
                        return coordinates && !isNaN(coordinates[0]) ? coordinates[0] : 0;
                    })
                    .attr("cy", function (d) {
                        var coordinates = projection([d.city_longitude, d.city_latitude]);
                        return coordinates && !isNaN(coordinates[1]) ? coordinates[1] : 0;
                    })
                    .on("mouseover", handleMouseOver)
                    .on("mouseout", handleMouseOut);
            }

            // Function to handle mouseover event for circles (cities)
            function handleMouseOver(event, d) {
                console.log("Mouse Over Event:", event);
                console.log("Data Object (d):", d);

                if (event.target.tagName === "circle") {
                    d3.select(this).attr("fill", "red");
                    var cityInfo =
                        `Date: ${d.date}, Home Team: ${d.home_team}, Away Team: ${d.away_team}, Result: ${d.home_score}-${d.away_score}`;
                    var infoBox = d3.select(".info-box");

                    // Adjust the position of the info box based on mouse coordinates
                    var xPosition = event.pageX - svg.node().getBoundingClientRect().left + 10;
                    var yPosition = event.pageY - svg.node().getBoundingClientRect().top + 10;

                    infoBox.html(cityInfo)
                        .style("left", xPosition + "px")
                        .style("top", yPosition + "px");

                    console.log("City Info:", cityInfo); // Log city information to the console
                }
            }


            // Function to handle mouseout event
            function handleMouseOut() {
                if (event.target.tagName === "circle") {
                    d3.select(this).attr("fill", "black");
                    // Remove additional information display or tooltip if added in mouseover
                }
            }

            // Initial data display (you can set a default year)
            updateData(years[0]);

            // Handle dropdown change event
            yearDropdown.on("change", function () {
                var selectedYear = d3.select(this).property("value");
                updateData(selectedYear);
            });
        });
        // Enable zoom
        svg.call(d3.zoom().on("zoom", function () {
            if (d3.event) {
                console.log(d3.event); // Log the event to the console
                mapGroup.attr("transform", d3.event.transform);
            }
        }));
    </script>

    <a href="stats.html" class="next-button">Next</a>
</body>

</html>